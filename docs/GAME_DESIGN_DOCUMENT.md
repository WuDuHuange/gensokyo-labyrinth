# 🎮 博丽灵梦的迷宫式 Roguelike - 长期计划文档

> **项目名称**: 幻想迷宫 (Gensokyo Labyrinth)  
> **主角**: 博丽灵梦  
> **类型**: 迷宫式 Roguelike，半回合制速度机制  
> **技术栈**: Phaser 3 前端框架  
> **画面风格**: 像素风格，镜头追随主角  
> **文档版本**: v1.0  
> **最后更新**: 2025年12月6日

---

## 📋 目录

1. [项目概述](#1-项目概述)
2. [核心玩法机制](#2-核心玩法机制)
3. [开发阶段规划](#3-开发阶段规划)
4. [系统设计详解](#4-系统设计详解)
5. [技术架构](#5-技术架构)
6. [资源需求](#6-资源需求)
7. [里程碑与时间线](#7-里程碑与时间线)

---

## 1. 项目概述

### 1.1 游戏愿景

打造一款融合东方 Project 世界观与经典 Roguelike 玩法的迷宫探索游戏。玩家扮演博丽灵梦，在充满妖精与危险的幻想乡迷宫中探索，利用符卡系统与速度策略击败敌人，最终抵达幻想之门。

### 1.2 核心特色

| 特色 | 描述 |
|------|------|
| 🎯 速度策略系统 | 半回合制机制，不同速度的敌人带来差异化战斗体验 |
| 📜 符卡系统 | 东方特色的技能系统，多种符卡组合搭配 |
| 🗺️ 程序化迷宫 | 每次探索生成不同的地图布局 |
| 🔄 Roguelike 成长 | 单次探索的临时成长 + 永久解锁的 Meta 进度 |

### 1.3 目标平台

- **主要平台**: Web 浏览器 (PC)
- **未来扩展**: Electron 桌面端打包

---

## 2. 核心玩法机制

### 2.1 速度机制 ⚡

速度系统是本游戏的核心战斗机制，采用行动点数队列系统：

```
┌─────────────────────────────────────────────────────────┐
│                    速度机制示意                          │
├─────────────────────────────────────────────────────────┤
│  灵梦速度 = 100 (基准单位)                               │
│                                                         │
│  慢速妖精 (速度 50):  灵梦行动2次，敌人行动1次           │
│  普通妖精 (速度 100): 灵梦与敌人交替行动                 │
│  快速妖精 (速度 200): 灵梦行动1次，敌人行动2次           │
└─────────────────────────────────────────────────────────┘
```

**行动队列算法**:
- 每个实体有累积行动值 (Action Points)
- 每回合所有实体增加其速度值的 AP
- AP 达到阈值 (如 100) 时可行动
- 行动后扣除阈值 AP

### 2.2 地图探索 🗺️

**地图结构**:
```
┌────────────────────────────────────────┐
│  ██████████████████████████████████    │
│  ██ 起点房 ████ 普通房 ████ 宝箱房 ██  │
│  ██   S   ═════   ◇   ═════   $   ██  │
│  ██████████████████████████████████    │
│       ║                    ║           │
│  ██████████████████████████████████    │
│  ██ 事件房 ████ 走廊  ████ BOSS房 ██  │
│  ██   ?   ═════  ···  ═════   B   ██  │
│  ██████████████████████████████████    │
│                            ║           │
│  ██████████████████████████████████    │
│  ██         幻想之门 (出口)        ██  │
│  ██            EXIT               ██  │
│  ██████████████████████████████████    │
└────────────────────────────────────────┘

图例: S=起点 ◇=普通房 $=宝箱 ?=事件 B=Boss ═║=走廊
```

**地图特性**:
| 特性 | 描述 |
|------|------|
| 格子化移动 | 基于 Tile 的移动系统 |
| 房间+走廊 | 经典 Roguelike 地图结构 |
| 可破坏墙体 | 部分墙体可用符卡破坏 |
| 迷雾系统 | 视野范围外为迷雾 (扩展功能) |

### 2.3 符卡系统 📜

**符卡类型**:

| 符卡名称 | 类型 | 效果 | 消耗 |
|----------|------|------|------|
| 珠符「明珠暗投」 | 反弹型 | 扔出三个会反弹的阴阳玉 | 30 灵力 |
| 梦符「封魔阵」 | 结界型 | 放置结界，敌人进入受伤 | 25 灵力 |
| 空符「梦想妙珠」 | 追踪型 |追踪光弹释放出多个光球，形似一串圆珠。 | 35 灵力 |

**符卡成长**:
```
基础符卡 → 强化 Lv1 → 强化 Lv2 → 究极形态
    ↓
  解锁变体符卡
```

### 2.4 敌人设计 👹

**Demo 阶段敌人**:

| 敌人类型 | 速度 | AI 行为 | 攻击方式 |
|----------|------|---------|----------|
| 慢速妖精 | 50 | 直线追踪 | 近战 |
| 普通妖精 | 100 | 直线追踪 | 近战 |
| 快速妖精 | 200 | 直线追踪 | 近战 |
| 扇形弹幕妖精 | 80 | 保持距离 | 扇形弹幕 (3发) |

### 2.5 Roguelike 成长 🔄

**单次 Run 内成长**:
- 道具拾取
- 临时属性提升
- 符卡强化

**永久 Meta 成长**:
- 符卡解锁
- 被动技能树
- 初始装备解锁

---

## 3. 开发阶段规划

### 📍 Phase 1: 初始 Demo (当前阶段)

**目标**: 验证核心玩法，完成可玩原型

| 模块 | 内容 | 状态 |
|------|------|------|
| 地图系统 | 128x128 固定地图生成 | ✅ 已完成 |
| 移动系统 | 格子化移动，镜头跟随 | ✅ 已完成 |
| 速度系统 | 基础行动队列 | ✅ 已完成 |
| 敌人 AI | 4种基础敌人 | ✅ 已完成 |
| 符卡 | 2种基础符卡 | ✅ 已完成 |
| UI | 基础 HUD | ✅ 已完成 |
| 目标 | 到达出口判定 | ✅ 已完成 |

**Demo 验收标准**:
- [x] 灵梦可在地图上移动
- [x] 速度系统正常运作
- [x] 4种敌人各具特色（慢速/普通/快速/弹幕妖精）
- [x] 2种符卡可正常使用（夢想封印/明珠暗投）
- [x] 可到达出口完成关卡

---

### 📍 Phase 2: 扩展 Demo

**目标**: 丰富游戏内容，增加可玩性

| 模块 | 内容 | 优先级 |
|------|------|--------|
| Boss 系统 | Boss 房间 + Boss AI | 高 |
| 符卡升级 | 符卡强化系统 | 高 |
| 事件房间 | 随机事件系统 | 中 |
| 战争迷雾 | Fog of War 系统 | 中 |
| 地图扩展 | 支持 256x256 以上 | 中 |
| 多层迷宫 | 层级切换系统 | 低 |

---

### 📍 Phase 3: 完整版

**目标**: 完整游戏体验

| 模块 | 内容 |
|------|------|
| 完整符卡树 | 20+ 符卡，多种流派 |
| 敌人图鉴 | 15+ 种敌人 |
| Boss 战 | 5+ Boss，独特机制 |
| Meta 成长 | 永久解锁系统 |
| 成就系统 | 成就与挑战 |
| 多结局 | 隐藏结局探索 |

---

### 📍 Phase 4: 后续扩展

**目标**: 持续内容更新

- 新可玩角色 (魔理沙、咲夜等)
- 每日挑战模式
- 种子码系统
- 排行榜
- 模组支持

---

## 4. 系统设计详解

### 4.1 行动队列系统

```javascript
// 伪代码示例
class ActionQueue {
    entities = [];  // 所有实体
    
    tick() {
        // 1. 所有实体增加 AP
        for (entity of entities) {
            entity.ap += entity.speed;
        }
        
        // 2. 检查可行动实体
        while (hasActionableEntity()) {
            const actor = getHighestAPEntity();
            if (actor.ap >= ACTION_THRESHOLD) {
                actor.performAction();
                actor.ap -= ACTION_THRESHOLD;
            }
        }
    }
}
```

### 4.2 地图生成算法

**Phase 1**: 手工设计 + 模板拼接
**Phase 2+**: BSP 树分割 + 房间连接算法

```
BSP 地图生成流程:
┌──────────────────────┐
│ 1. 初始化地图区域     │
├──────────────────────┤
│ 2. BSP 递归分割       │
├──────────────────────┤
│ 3. 在叶节点生成房间   │
├──────────────────────┤
│ 4. 连接相邻房间       │
├──────────────────────┤
│ 5. 放置特殊房间       │
│    (起点/Boss/出口)   │
├──────────────────────┤
│ 6. 填充敌人和道具     │
└──────────────────────┘
```

### 4.3 符卡系统架构

```
SpellCard (基类)
├── ProjectileSpellCard (弹幕型)
│   ├── LinearProjectile (直线)
│   ├── SpreadProjectile (扇形)
│   └── HomingProjectile (追踪)
├── AreaSpellCard (范围型)
│   ├── CircleArea (圆形)
│   └── RectArea (矩形)
├── MovementSpellCard (位移型)
│   ├── Dash (冲刺)
│   └── Teleport (瞬移)
└── SupportSpellCard (辅助型)
    ├── Barrier (结界)
    └── Buff (增益)
```

### 4.4 敌人 AI 状态机

```
         ┌─────────┐
         │  IDLE   │ ← 初始状态
         └────┬────┘
              │ 发现玩家
              ▼
         ┌─────────┐
    ┌────│  CHASE  │────┐
    │    └────┬────┘    │
    │         │ 进入攻击范围
    │         ▼         │
    │    ┌─────────┐    │
    │    │ ATTACK  │    │
    │    └────┬────┘    │
    │         │ 脱离视野
    │         ▼         │
    │    ┌─────────┐    │
    └───►│ RETURN  │◄───┘
         └─────────┘
```

---

## 5. 技术架构

### 5.1 项目结构

```
Rouge-like/
├── src/
│   ├── main.js              # 游戏入口
│   ├── config/
│   │   └── gameConfig.js    # Phaser 配置
│   ├── scenes/
│   │   ├── BootScene.js     # 启动场景
│   │   ├── PreloadScene.js  # 资源加载
│   │   ├── MenuScene.js     # 主菜单
│   │   ├── GameScene.js     # 主游戏场景
│   │   └── UIScene.js       # UI 层
│   ├── entities/
│   │   ├── Player.js        # 灵梦
│   │   ├── Enemy.js         # 敌人基类
│   │   └── enemies/         # 具体敌人
│   ├── systems/
│   │   ├── ActionQueue.js   # 行动队列
│   │   ├── MapGenerator.js  # 地图生成
│   │   ├── SpellCard.js     # 符卡系统
│   │   └── FogOfWar.js      # 迷雾系统
│   ├── ui/
│   │   ├── HUD.js           # 游戏 HUD
│   │   └── Minimap.js       # 小地图
│   └── utils/
│       └── helpers.js       # 工具函数
├── assets/
│   ├── sprites/             # 精灵图
│   ├── tilemaps/            # 地图瓦片
│   ├── audio/               # 音效音乐
│   └── fonts/               # 字体
├── docs/                    # 文档
├── index.html               # 入口 HTML
└── package.json
```

### 5.2 核心类图

```
┌─────────────────────────────────────────────────────────┐
│                      GameScene                          │
├─────────────────────────────────────────────────────────┤
│ - player: Player                                        │
│ - enemies: Enemy[]                                      │
│ - actionQueue: ActionQueue                              │
│ - mapManager: MapManager                                │
│ - spellCardSystem: SpellCardSystem                      │
├─────────────────────────────────────────────────────────┤
│ + create()                                              │
│ + update()                                              │
│ + handleInput()                                         │
└─────────────────────────────────────────────────────────┘
                          │
          ┌───────────────┼───────────────┐
          ▼               ▼               ▼
    ┌──────────┐   ┌──────────┐   ┌──────────────┐
    │  Player  │   │  Enemy   │   │ ActionQueue  │
    ├──────────┤   ├──────────┤   ├──────────────┤
    │ hp       │   │ hp       │   │ entities[]   │
    │ mp       │   │ speed    │   │ currentActor │
    │ speed    │   │ aiState  │   ├──────────────┤
    │ spells[] │   ├──────────┤   │ tick()       │
    ├──────────┤   │ update() │   │ addEntity()  │
    │ move()   │   │ attack() │   │ getNext()    │
    │ attack() │   └──────────┘   └──────────────┘
    │ useSpell()│
    └──────────┘
```

### 5.3 技术选型

| 类别 | 选择 | 原因 |
|------|------|------|
| 游戏框架 | Phaser 3 | 成熟的 2D 游戏框架 |
| 语言 | JavaScript/ES6+ | 浏览器原生支持 |
| 构建工具 | Vite | 快速的开发服务器 |
| 地图编辑 | Tiled | 标准瓦片地图编辑器 |
| 版本控制 | Git | 标准版本控制 |

---

## 6. 资源需求

### 6.1 美术资源

**Phase 1 必需**:
| 资源 | 规格 | 数量 |
|------|------|------|
| 灵梦像素单图 | 32x32,| 1套 |
| 妖精敌人 | 32x32| 3套 |
| 地图瓦片 | 16x16 或 32x32 | 1套 |
| 符卡特效 | 动画序列帧 | 2套 |
| UI 元素 | 各类按钮、框架 | 1套 |

### 6.2 音频资源

| 类型 | 内容 | 优先级 |
|------|------|--------|
| BGM | 迷宫探索曲 | 中 |
| SE | 移动、攻击、符卡 | 高 |
| SE | UI 交互音效 | 低 |

---

## 7. 里程碑与时间线

### 🎯 Milestone 1: 基础框架 (Week 1-2)

- [ ] 项目初始化，Phaser 3 环境搭建
- [ ] 基础场景切换
- [ ] 玩家移动控制
- [ ] 摄像机跟随

### 🎯 Milestone 2: 地图系统 (Week 3-4)

- [ ] Tilemap 加载显示
- [ ] 碰撞检测
- [ ] 基础地图生成
- [ ] 房间连接

### 🎯 Milestone 3: 战斗系统 (Week 5-6)

- [ ] 行动队列实现
- [ ] 敌人 AI 基础
- [ ] 近战攻击
- [ ] 伤害计算

### 🎯 Milestone 4: 符卡系统 (Week 7-8)

- [ ] 符卡基类
- [ ] 「夢想封印」实现
- [ ] 「明珠暗投」实现
- [ ] 灵力系统

### 🎯 Milestone 5: Demo 完善 (Week 9-10)

- [ ] UI/HUD 完善
- [ ] 游戏流程（开始→通关）
- [ ] 死亡/重开
- [ ] Bug 修复与平衡

---

## 📝 附录

### A. 参考游戏

- 不思议迷宫
- 以撒的结合
- 杀戮尖塔
- 东方系列

### B. 术语表

| 术语 | 解释 |
|------|------|
| Run | 单次游戏流程 |
| Meta 成长 | 跨 Run 的永久成长 |
| 符卡 | 灵梦的特殊技能 |
| Tile | 地图格子单位 |

### C. 更新日志

| 日期 | 版本 | 更新内容 |
|------|------|----------|
| 2025-12-06 | v1.0 | 初始文档创建 |

---

> 📌 **备注**: 本文档为长期规划文档，将随开发进度持续更新。
